// Compiled by ClojureScript 0.0-2138
goog.provide('lt.objs.cli');
goog.require('cljs.core');
goog.require('lt.util.load');
goog.require('lt.util.cljs');
goog.require('lt.objs.app');
goog.require('lt.objs.files');
goog.require('lt.objs.opener');
goog.require('lt.objs.workspace');
goog.require('lt.objs.workspace');
goog.require('clojure.string');
goog.require('lt.util.cljs');
goog.require('lt.objs.files');
goog.require('lt.objs.opener');
goog.require('lt.objs.app');
goog.require('clojure.string');
goog.require('lt.object');
goog.require('lt.object');
goog.require('lt.util.load');
lt.objs.cli.rebuild_argv = (function rebuild_argv(argstr){return cljs.core.to_array.call(null,clojure.string.split.call(null,clojure.string.replace.call(null,clojure.string.replace.call(null,cljs.core.subs.call(null,argstr,argstr.indexOf("<d><d>dir")),"<d>","-"),"<s>"," ")," "));
});
lt.objs.cli.parse_args = (function parse_args(argv){return lt.util.cljs.js__GT_clj.call(null,lt.util.load.node_module.call(null,"optimist").options((function (){var obj7283 = {"n":(function (){var obj7285 = {"boolean":true,"alias":"new"};return obj7285;
})(),"a":(function (){var obj7287 = {"boolean":true,"alias":"add"};return obj7287;
})(),"w":(function (){var obj7289 = {"boolean":true,"alias":"wait"};return obj7289;
})(),"h":(function (){var obj7291 = {"boolean":true,"alias":"help"};return obj7291;
})()};return obj7283;
})()).parse(argv),new cljs.core.Keyword(null,"keywordize-keys","keywordize-keys",4191781672),true);
});
lt.objs.cli.open_paths = (function open_paths(paths,add_QMARK_){var seq__7298 = cljs.core.seq.call(null,paths);var chunk__7300 = null;var count__7301 = 0;var i__7302 = 0;while(true){
if((i__7302 < count__7301))
{var path = cljs.core._nth.call(null,chunk__7300,i__7302);if(cljs.core.not_EQ_.call(null,path,process.execPath))
{if(cljs.core.truth_(lt.objs.files.exists_QMARK_.call(null,path)))
{if(cljs.core.truth_(lt.objs.files.dir_QMARK_.call(null,path)))
{lt.object.raise.call(null,lt.objs.workspace.current_ws,new cljs.core.Keyword(null,"add.folder!","add.folder!",2151595160),path);
} else
{lt.object.raise.call(null,lt.objs.opener.opener,new cljs.core.Keyword(null,"open!","open!",1119852169),path);
if(cljs.core.truth_(add_QMARK_))
{lt.object.raise.call(null,lt.objs.workspace.current_ws,new cljs.core.Keyword(null,"add.file!","add.file!",4237252106),path);
} else
{}
}
} else
{lt.object.raise.call(null,lt.objs.opener.opener,new cljs.core.Keyword(null,"new!","new!",1017282035),path);
}
{
var G__7304 = seq__7298;
var G__7305 = chunk__7300;
var G__7306 = count__7301;
var G__7307 = (i__7302 + 1);
seq__7298 = G__7304;
chunk__7300 = G__7305;
count__7301 = G__7306;
i__7302 = G__7307;
continue;
}
} else
{{
var G__7308 = seq__7298;
var G__7309 = chunk__7300;
var G__7310 = count__7301;
var G__7311 = (i__7302 + 1);
seq__7298 = G__7308;
chunk__7300 = G__7309;
count__7301 = G__7310;
i__7302 = G__7311;
continue;
}
}
} else
{var temp__4092__auto__ = cljs.core.seq.call(null,seq__7298);if(temp__4092__auto__)
{var seq__7298__$1 = temp__4092__auto__;if(cljs.core.chunked_seq_QMARK_.call(null,seq__7298__$1))
{var c__4150__auto__ = cljs.core.chunk_first.call(null,seq__7298__$1);{
var G__7312 = cljs.core.chunk_rest.call(null,seq__7298__$1);
var G__7313 = c__4150__auto__;
var G__7314 = cljs.core.count.call(null,c__4150__auto__);
var G__7315 = 0;
seq__7298 = G__7312;
chunk__7300 = G__7313;
count__7301 = G__7314;
i__7302 = G__7315;
continue;
}
} else
{var path = cljs.core.first.call(null,seq__7298__$1);if(cljs.core.not_EQ_.call(null,path,process.execPath))
{if(cljs.core.truth_(lt.objs.files.exists_QMARK_.call(null,path)))
{if(cljs.core.truth_(lt.objs.files.dir_QMARK_.call(null,path)))
{lt.object.raise.call(null,lt.objs.workspace.current_ws,new cljs.core.Keyword(null,"add.folder!","add.folder!",2151595160),path);
} else
{lt.object.raise.call(null,lt.objs.opener.opener,new cljs.core.Keyword(null,"open!","open!",1119852169),path);
if(cljs.core.truth_(add_QMARK_))
{lt.object.raise.call(null,lt.objs.workspace.current_ws,new cljs.core.Keyword(null,"add.file!","add.file!",4237252106),path);
} else
{}
}
} else
{lt.object.raise.call(null,lt.objs.opener.opener,new cljs.core.Keyword(null,"new!","new!",1017282035),path);
}
{
var G__7316 = cljs.core.next.call(null,seq__7298__$1);
var G__7317 = null;
var G__7318 = 0;
var G__7319 = 0;
seq__7298 = G__7316;
chunk__7300 = G__7317;
count__7301 = G__7318;
i__7302 = G__7319;
continue;
}
} else
{{
var G__7320 = cljs.core.next.call(null,seq__7298__$1);
var G__7321 = null;
var G__7322 = 0;
var G__7323 = 0;
seq__7298 = G__7320;
chunk__7300 = G__7321;
count__7301 = G__7322;
i__7302 = G__7323;
continue;
}
}
}
} else
{return null;
}
}
break;
}
});
lt.objs.cli.args_key = (function args_key(winid){return [cljs.core.str("window"),cljs.core.str(winid),cljs.core.str("args")].join('');
});
lt.objs.cli.args = (function args(){var or__3408__auto__ = lt.objs.app.fetch.call(null,lt.objs.cli.args_key.call(null,lt.objs.app.window_number.call(null)));if(cljs.core.truth_(or__3408__auto__))
{return or__3408__auto__;
} else
{var and__3396__auto__ = cljs.core._EQ_.call(null,lt.objs.app.window_number.call(null),0);if(and__3396__auto__)
{return cljs.core.first.call(null,lt.objs.app.args.call(null));
} else
{return and__3396__auto__;
}
}
});
lt.objs.cli.is_lt_binary_QMARK_ = (function is_lt_binary_QMARK_(path){return new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 4, ["node-webkit",null,"LightTable",null,"LightTable.exe",null,"ltbin",null], null), null).call(null,clojure.string.trim.call(null,lt.objs.files.basename.call(null,path)));
});
lt.objs.cli.valid_path_QMARK_ = (function valid_path_QMARK_(path){return (typeof path === 'string') && (!(cljs.core.empty_QMARK_.call(null,path))) && (cljs.core.not.call(null,lt.objs.cli.is_lt_binary_QMARK_.call(null,path)));
});
lt.objs.cli.__BEH__open_on_args = (function __BEH__open_on_args(this$){if(cljs.core.truth_(lt.objs.cli.args.call(null)))
{var args_str = (function (){var or__3408__auto__ = lt.objs.app.extract_BANG_.call(null,lt.objs.cli.args_key.call(null,lt.objs.app.window_number.call(null)));if(cljs.core.truth_(or__3408__auto__))
{return or__3408__auto__;
} else
{return cljs.core.first.call(null,lt.objs.app.args.call(null));
}
})();var args = lt.objs.cli.parse_args.call(null,lt.objs.cli.rebuild_argv.call(null,args_str));var paths = cljs.core.map.call(null,((function (args_str,args){
return (function (p1__7324_SHARP_){return lt.objs.files.resolve.call(null,new cljs.core.Keyword(null,"dir","dir",1014003711).cljs$core$IFn$_invoke$arity$1(args),p1__7324_SHARP_);
});})(args_str,args))
,cljs.core.filter.call(null,lt.objs.cli.valid_path_QMARK_,new cljs.core.Keyword(null,"_","_",1013904337).cljs$core$IFn$_invoke$arity$1(args)));var open_dir_QMARK_ = cljs.core.some.call(null,lt.objs.files.dir_QMARK_,paths);if(cljs.core.truth_(open_dir_QMARK_))
{lt.object.merge_BANG_.call(null,lt.objs.workspace.current_ws,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"initialized?","initialized?",613820253),true], null));
} else
{}
return lt.objs.cli.open_paths.call(null,paths,new cljs.core.Keyword(null,"add","add",1014000659).cljs$core$IFn$_invoke$arity$1(args));
} else
{return null;
}
});
lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.cli","open-on-args","lt.objs.cli/open-on-args",3169685299),new cljs.core.Keyword(null,"reaction","reaction",4441361819),lt.objs.cli.__BEH__open_on_args,new cljs.core.Keyword(null,"triggers","triggers",2516997421),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"post-init","post-init",2970371471),null], null), null));
lt.objs.cli.__BEH__open_BANG_ = (function __BEH__open_BANG_(this$,path){if(cljs.core._EQ_.call(null,lt.objs.app.fetch.call(null,new cljs.core.Keyword(null,"focusedWindow","focusedWindow",2946535865)),lt.objs.app.window_number.call(null)))
{var args = lt.objs.cli.parse_args.call(null,lt.objs.cli.rebuild_argv.call(null,path));var paths = cljs.core.map.call(null,((function (args){
return (function (p1__7325_SHARP_){return lt.objs.files.resolve.call(null,new cljs.core.Keyword(null,"dir","dir",1014003711).cljs$core$IFn$_invoke$arity$1(args),p1__7325_SHARP_);
});})(args))
,cljs.core.filter.call(null,lt.objs.cli.valid_path_QMARK_,new cljs.core.Keyword(null,"_","_",1013904337).cljs$core$IFn$_invoke$arity$1(args)));var open_dir_QMARK_ = cljs.core.some.call(null,lt.objs.files.dir_QMARK_,paths);if(cljs.core.truth_((function (){var or__3408__auto__ = new cljs.core.Keyword(null,"new","new",1014013202).cljs$core$IFn$_invoke$arity$1(args);if(cljs.core.truth_(or__3408__auto__))
{return or__3408__auto__;
} else
{var and__3396__auto__ = open_dir_QMARK_;if(cljs.core.truth_(and__3396__auto__))
{return cljs.core.not.call(null,new cljs.core.Keyword(null,"add","add",1014000659).cljs$core$IFn$_invoke$arity$1(args));
} else
{return and__3396__auto__;
}
}
})()))
{var winid = (lt.objs.app.fetch.call(null,new cljs.core.Keyword(null,"window-id","window-id",796854154)) + 1);lt.objs.app.store_BANG_.call(null,lt.objs.cli.args_key.call(null,winid),path);
return lt.objs.app.open_window.call(null);
} else
{return lt.objs.cli.open_paths.call(null,paths,new cljs.core.Keyword(null,"add","add",1014000659).cljs$core$IFn$_invoke$arity$1(args));
}
} else
{return null;
}
});
lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.cli","open!","lt.objs.cli/open!",969056930),new cljs.core.Keyword(null,"reaction","reaction",4441361819),lt.objs.cli.__BEH__open_BANG_,new cljs.core.Keyword(null,"triggers","triggers",2516997421),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"open!","open!",1119852169),null], null), null));
